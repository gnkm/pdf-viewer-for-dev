# ソフトウェア要求仕様書 (SRS)
**プロジェクト名:** PDF Viewer for Developers (vfd)
**バージョン:** 1.0

## 1. はじめに (Introduction)

### 1.1 目的 (Purpose)
本書は、開発者向けPDF閲覧ソフトウェア「PDF Viewer for Developers（以下、本システム）」の要求仕様を定義するものである。本システムは、キーボード操作を主とする開発者（Vim/Emacsユーザー）に対し、マウスレスで高効率なドキュメント閲覧体験を提供することを目的とする。

### 1.2 範囲 (Scope)
本システムは、Dart言語およびFlutterフレームワークを用いて開発されるデスクトップアプリケーションである。
主な特徴として、EmacsおよびVimに準拠したキーバインド、CLI（コマンドラインインターフェイス）からの起動、および開発者の作業フローを阻害しない軽量な動作を提供する。

### 1.3 定義・略語 (Definitions)
* **Vimモード:** `j/k` キー等による移動を中心とした操作体系。
* **Emacsモード:** `C-n/C-p` キー等による移動を中心とした操作体系。
* **TOML:** 設定ファイルの記述形式 (Tom's Obvious, Minimal Language)。

## 2. 参照 (References)
* ISO/IEC/IEEE 29148:2018 Systems and software engineering — Life cycle processes — Requirements engineering
* Dart Language Specification
* Flutter Framework Documentation
* TOML Specification (v1.0.0)

## 3. 具体的な要求 (Specific Requirements)

### 3.1 機能要件 (Functional Requirements)

#### 3.1.1 起動とファイル読み込み (Startup and File Loading)
1.  **CLI起動:** システムは、コマンドライン引数としてファイルパスを受け取った場合 (`vfd <file_path>`)、当該ファイルを開いた状態で起動**しなければならない**。
2.  **UIからのファイル選択:** システムは、所定のキー操作 (`C-x C-f` または `:e`) または画面上のボタン押下により、OS標準のファイル選択ダイアログを表示**しなければならない**。
3.  **エラーハンドリング:** 指定されたファイルが存在しない、または破損している場合、システムはアプリケーションをクラッシュさせず、エラーメッセージを画面中央に表示**しなければならない**。

#### 3.1.2 表示制御 (Display Control)
1.  **表示モード:** システムは、以下の2つの表示モードを提供**しなければならない**。
    * **実寸表示 (Actual Size):** ドキュメントを100%のスケールで表示する。
    * **画面に合わせる (Fit to Screen):** ページ全体がウィンドウ内に収まるよう、倍率を動的に調整して表示する。
2.  **ズーム操作:**
    * ズームイン・ズームアウト操作により、表示倍率を任意の段階に変更できること。
    * リセット操作により、**「実寸表示 (100%)」** へ復帰すること。

#### 3.1.3 操作モードとキーバインド (Input Modes and Key Bindings)
システムは、「Emacsモード」と「Vimモード」の2つの入力モードを持たなければならない。各モードにおける操作とキーバインドの対応は下表の通り定義する。

| 機能 (Function) | Emacs Mode Binding | Vim Mode Binding | 備考 |
| :--- | :--- | :--- | :--- |
| **ナビゲーション** | | | |
| 次のページへ移動 | `C-n` | `j` | |
| 前のページへ移動 | `C-p` | `k` | |
| ドキュメント先頭へ移動 | `M-<` | `g g` | |
| ドキュメント末尾へ移動 | `M->` | `G` | |
| ページジャンプ (割合) | 数字キー `1` ～ `9` | 数字キー `1` ～ `9` | 全ページ数の n割 の位置へ移動 |
| **表示操作** | | | |
| ズームイン | `Cmd` + `+` | `Ctrl` + `+` | |
| ズームアウト | `Cmd` + `-` | `Ctrl` + `-` | |
| ズームリセット | `Cmd` + `0` | `Ctrl` + `0` | 実寸表示 (100%) へ |
| 画面に合わせる | `f` | `f` | Fit to Screen へ切り替え |
| **ファイル操作** | | | |
| ファイルを開く | `C-x C-f` | `:e` | |
| 検索開始 | `C-s` | `/` | |

#### 3.1.4 検索機能 (Search Function)
1.  **入力UI:** 検索キーバインドが押下された際、システムは画面上部に検索入力フィールドを表示し、フォーカスを移動**しなければならない**。
2.  **検索実行:** 検索語句入力後 `Enter` キーが押下された際、システムは現在のページ以降で最初に一致する文字列へジャンプし、ハイライト表示**しなければならない**。
3.  **次/前の一致:** 検索実行中、`n` (次) または `N` (前) などの操作で一致箇所を巡回可能と**すべきである**。

#### 3.1.5 テキスト選択とコピー (Text Selection and Copy)
1.  **範囲選択:** システムは、マウスドラッグによるテキスト範囲選択を可能と**しなければならない**。

#### 3.1.6 状態と設定の管理 (State and Configuration Management)
1.  **モード切替:** システムは、ステータスバーのクリック操作により、Emacs/Vimモードをトグル切り替え可能と**しなければならない**。この変更は一時的なものであり、設定ファイルには即時反映しなくてもよい。
2.  **起動時の状態復元:**
    * システムは起動時、保存された「前回の閲覧情報（ファイル、ページ、ズーム率）」が存在する場合、それを適用して**起動しなければならない**。
    * 保存された状態が存在しない（初回起動や履歴削除後）場合、**「画面に合わせる (Fit to Screen)」** モードで起動**しなければならない**。
3.  **終了時の状態保存:** アプリケーション終了時、システムは以下の情報を永続化領域に保存**しなければならない**。
    * 最後に開いていたファイルのパス
    * 最後の閲覧ページ番号
    * 最後のズーム率

### 3.2 外部インターフェイス要求 (External Interface Requirements)
1.  **設定ファイル:** システムは、起動時に `~/.config/pdf-viewer-for-dev/config.toml` を読み込み、デフォルトのモード（Emacs/Vim）やテーマ設定を適用**しなければならない**。

### 3.3 パフォーマンス要件 (Performance Requirements)
以下の要件は、基準となるハードウェア（例: Apple Silicon M1 / Intel Core i5 第10世代以降, メモリ8GB以上）において満たされること。
1.  **起動時間:** コールドスタートからファイルが表示されるまでの時間は **1.0秒以内** であること。
2.  **ページ遷移:** ページ送り操作から描画完了までのレイテンシは **500ミリ秒以内** であること。
3.  **メモリ使用:** 1000ページを超えるPDFを開いた状態でも、アプリケーションのメモリ使用量は安定し、著しいリークが発生しないこと。

### 3.4 設計制約 (Design Constraints)
1.  **開発言語:** Dart (最新の安定版を使用すること)。
2.  **フレームワーク:** Flutter (デスクトップターゲット)。
3.  **ライブラリ:** PDFレンダリングには、パフォーマンスとデスクトップ対応に優れた **`pdfrx`** パッケージを使用すること。

### 3.5 ソフトウェアシステム属性 (Software System Attributes)
1.  **移植性 (Portability):** macOS, Windows, Linux の各最新メジャーバージョンおよびその1つ前のバージョンで動作すること。
2.  **セキュリティ (Security):** システムは、ユーザーが明示的に読み込み操作を行ったローカルファイル以外へのアクセスを行ってはならない。また、外部サーバーへの通信機能を持ってはならない。
